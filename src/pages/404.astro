---
import Layout from '@/layouts/Layout.astro';

// Images for school category cards
import elementaryImage from '@/images/USED-elementary-school-2.jpg';
import privateSchoolImage from '@/images/USED-closeup_of_three_happy_diverse_private_school_stud_08d90804-c48d-46e1-a602-bd01f03b1668_2.jpg';
import charterSchoolImage from '@/images/USED-happy-student-school-uniform.jpg';
import magnetSchoolImage from '@/images/USED-ai-classroom-technology-students.jpg';
import vocationalSchoolImage from '@/images/USED-female_healthcare_technician_in_scrubs_holding_a_c71628ab-5351-47a5-b215-6e2b5021cbb9_3.jpg';
import collegeImage from '@/images/USED-college-1.jpg';

// Article images
import articleCharterImage from '@/images/USED-student-thoughtful-classroom-portrait.jpg';
import articleFinancialAidImage from '@/images/USED-price-of-admission-financial-aid-2.jpg';
import articlePreschoolImage from '@/images/USED-kindergarten-classroom-environment.jpg';

const db = Astro.locals.runtime?.env?.DB;

// Get stats for the page
let stats = {
  totalSchools: 0,
  totalColleges: 0,
  vocationalTotal: 0,
};

if (db) {
  try {
    const [schoolCount, collegeCount, vocationalCount] = await Promise.all([
      db.prepare('SELECT COUNT(*) as count FROM schools WHERE active = 1').first(),
      db.prepare('SELECT COUNT(*) as count FROM colleges WHERE active = 1').first(),
      db.prepare("SELECT COUNT(*) as count FROM colleges WHERE vocational_type IS NOT NULL AND active = 1").first(),
    ]);
    stats.totalSchools = (schoolCount as any)?.count || 0;
    stats.totalColleges = (collegeCount as any)?.count || 0;
    stats.vocationalTotal = (vocationalCount as any)?.count || 0;
  } catch (e) {
    // Database not available
  }
}

// School categories for quick navigation
const schoolCategories = [
  { title: 'All K-12 Schools', href: '/schools', image: elementaryImage, description: 'Browse all public and private K-12 schools' },
  { title: 'Private Schools', href: '/private-schools', image: privateSchoolImage, description: 'Independent schools with diverse curricula' },
  { title: 'Charter Schools', href: '/charter-schools', image: charterSchoolImage, description: 'Publicly funded, independently operated' },
  { title: 'Magnet Schools', href: '/magnet-schools', image: magnetSchoolImage, description: 'Specialized programs and themes' },
  { title: 'Colleges', href: '/colleges-universities', image: collegeImage, description: 'Universities and 4-year institutions' },
  { title: 'Vocational', href: '/vocational-schools', image: vocationalSchoolImage, description: 'Trade and career training programs' },
];

// Featured articles
const featuredArticles = [
  {
    title: 'Is a Charter School Right for Your Child?',
    url: '/education-articles/is-a-charter-school-right-for-your-child',
    image: articleCharterImage,
    description: 'Charter schools offer unique educational approaches, but they\'re not for everyone.',
  },
  {
    title: 'The Price of Admission: Financial Aid 101',
    url: '/education-articles/the-price-of-admission',
    image: articleFinancialAidImage,
    description: 'Navigating college financial aid forms and formulas.',
  },
  {
    title: 'What Does a Good Preschool Look Like?',
    url: '/education-articles/what-does-a-good-preschool-look-like',
    image: articlePreschoolImage,
    description: 'What actually matters when choosing a preschool.',
  },
];

// States for dropdown
const states = [
  { name: 'Alabama', slug: 'alabama' },
  { name: 'Alaska', slug: 'alaska' },
  { name: 'Arizona', slug: 'arizona' },
  { name: 'Arkansas', slug: 'arkansas' },
  { name: 'California', slug: 'california' },
  { name: 'Colorado', slug: 'colorado' },
  { name: 'Connecticut', slug: 'connecticut' },
  { name: 'Delaware', slug: 'delaware' },
  { name: 'District of Columbia', slug: 'district-of-columbia' },
  { name: 'Florida', slug: 'florida' },
  { name: 'Georgia', slug: 'georgia' },
  { name: 'Hawaii', slug: 'hawaii' },
  { name: 'Idaho', slug: 'idaho' },
  { name: 'Illinois', slug: 'illinois' },
  { name: 'Indiana', slug: 'indiana' },
  { name: 'Iowa', slug: 'iowa' },
  { name: 'Kansas', slug: 'kansas' },
  { name: 'Kentucky', slug: 'kentucky' },
  { name: 'Louisiana', slug: 'louisiana' },
  { name: 'Maine', slug: 'maine' },
  { name: 'Maryland', slug: 'maryland' },
  { name: 'Massachusetts', slug: 'massachusetts' },
  { name: 'Michigan', slug: 'michigan' },
  { name: 'Minnesota', slug: 'minnesota' },
  { name: 'Mississippi', slug: 'mississippi' },
  { name: 'Missouri', slug: 'missouri' },
  { name: 'Montana', slug: 'montana' },
  { name: 'Nebraska', slug: 'nebraska' },
  { name: 'Nevada', slug: 'nevada' },
  { name: 'New Hampshire', slug: 'new-hampshire' },
  { name: 'New Jersey', slug: 'new-jersey' },
  { name: 'New Mexico', slug: 'new-mexico' },
  { name: 'New York', slug: 'new-york' },
  { name: 'North Carolina', slug: 'north-carolina' },
  { name: 'North Dakota', slug: 'north-dakota' },
  { name: 'Ohio', slug: 'ohio' },
  { name: 'Oklahoma', slug: 'oklahoma' },
  { name: 'Oregon', slug: 'oregon' },
  { name: 'Pennsylvania', slug: 'pennsylvania' },
  { name: 'Rhode Island', slug: 'rhode-island' },
  { name: 'South Carolina', slug: 'south-carolina' },
  { name: 'South Dakota', slug: 'south-dakota' },
  { name: 'Tennessee', slug: 'tennessee' },
  { name: 'Texas', slug: 'texas' },
  { name: 'Utah', slug: 'utah' },
  { name: 'Vermont', slug: 'vermont' },
  { name: 'Virginia', slug: 'virginia' },
  { name: 'Washington', slug: 'washington' },
  { name: 'West Virginia', slug: 'west-virginia' },
  { name: 'Wisconsin', slug: 'wisconsin' },
  { name: 'Wyoming', slug: 'wyoming' },
];

// Popular states (highest population)
const popularStates = ['california', 'texas', 'florida', 'new-york', 'pennsylvania', 'illinois', 'ohio', 'georgia'];

// Get the requested URL for context-aware suggestions
const requestedUrl = Astro.url.pathname.toLowerCase();

// Determine what type of content they might be looking for based on URL
let suggestedSection = '';
let suggestedLinks: { label: string; url: string }[] = [];

if (requestedUrl.includes('college') || requestedUrl.includes('university')) {
  suggestedSection = 'colleges';
  suggestedLinks = [
    { label: 'Browse All Colleges', url: '/colleges-universities' },
    { label: 'College Financial Aid', url: '/financial-aid' },
    { label: 'FAFSA School Codes', url: '/financial-aid/fafsa/fafsa-school-codes' },
  ];
} else if (requestedUrl.includes('vocational') || requestedUrl.includes('trade') || requestedUrl.includes('beauty') || requestedUrl.includes('culinary')) {
  suggestedSection = 'vocational';
  suggestedLinks = [
    { label: 'Browse Vocational Schools', url: '/vocational-schools' },
    { label: 'Beauty Schools', url: '/vocational-schools/beauty-schools' },
    { label: 'Trade Schools', url: '/vocational-schools/trade-schools' },
  ];
} else if (requestedUrl.includes('charter')) {
  suggestedSection = 'charter';
  suggestedLinks = [
    { label: 'Browse Charter Schools', url: '/charter-schools' },
    { label: 'Charter School Guide', url: '/education-articles/is-a-charter-school-right-for-your-child' },
  ];
} else if (requestedUrl.includes('private')) {
  suggestedSection = 'private';
  suggestedLinks = [
    { label: 'Browse Private Schools', url: '/private-schools' },
  ];
} else if (requestedUrl.includes('magnet')) {
  suggestedSection = 'magnet';
  suggestedLinks = [
    { label: 'Browse Magnet Schools', url: '/magnet-schools' },
  ];
} else if (requestedUrl.includes('preschool') || requestedUrl.includes('kindergarten')) {
  suggestedSection = 'early';
  suggestedLinks = [
    { label: 'Browse Preschools', url: '/preschools' },
    { label: 'Browse Kindergartens', url: '/kindergartens' },
    { label: 'Preschool Guide', url: '/education-articles/what-does-a-good-preschool-look-like' },
  ];
} else if (requestedUrl.includes('elementary')) {
  suggestedSection = 'elementary';
  suggestedLinks = [
    { label: 'Browse Elementary Schools', url: '/elementary-schools' },
  ];
} else if (requestedUrl.includes('middle')) {
  suggestedSection = 'middle';
  suggestedLinks = [
    { label: 'Browse Middle Schools', url: '/middle-schools' },
  ];
} else if (requestedUrl.includes('high')) {
  suggestedSection = 'high';
  suggestedLinks = [
    { label: 'Browse High Schools', url: '/high-schools' },
    { label: 'Graduation Requirements', url: '/education-articles/high-school-graduation-requirements-by-state' },
  ];
}
---

<Layout title="Page Not Found" noIndex={true}>
  <div class="container py-10 md:py-16">
    <!-- Main 404 Header -->
    <div class="text-center mb-10">
      <h1 class="text-[80px] md:text-[120px] font-bold text-brand-blue leading-none mb-2">404</h1>
      <h2 class="text-2xl md:text-3xl font-semibold text-gray-800 mb-3">Page Not Found</h2>
      <p class="text-gray-600 max-w-lg mx-auto mb-6">
        Sorry, the page you're looking for doesn't exist or has been moved.
        We recently redesigned our site, so some old links may no longer work.
      </p>

      <!-- Site Stats -->
      <div class="flex justify-center gap-6 text-sm text-gray-500 mb-8">
        <span><strong class="text-brand-blue">{stats.totalSchools > 0 ? stats.totalSchools.toLocaleString() : '121,000+'}</strong> K-12 Schools</span>
        <span><strong class="text-brand-blue">{stats.totalColleges > 0 ? stats.totalColleges.toLocaleString() : '7,900+'}</strong> Colleges</span>
        <span><strong class="text-brand-blue">{stats.vocationalTotal > 0 ? stats.vocationalTotal.toLocaleString() : '2,400+'}</strong> Vocational</span>
      </div>
    </div>

    <!-- Inline Search Box -->
    <div class="max-w-xl mx-auto mb-12">
      <form action="/search" method="GET" class="relative">
        <input
          type="text"
          name="q"
          placeholder="Search by school name, city, or ZIP code..."
          class="w-full pl-12 pr-4 py-4 text-lg rounded-xl border-2 border-gray-200 bg-white text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-blue focus:border-brand-blue transition-all shadow-sm"
          autofocus
        />
        <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 btn-blue px-5 py-2">
          Search
        </button>
      </form>
    </div>

    <!-- Context-Aware Suggestions (if applicable) -->
    {suggestedLinks.length > 0 && (
      <div class="max-w-2xl mx-auto mb-12 bg-blue-50 border border-blue-200 rounded-xl p-5">
        <p class="text-brand-blue font-semibold mb-3">
          <svg class="w-5 h-5 inline-block mr-1 -mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Looking for {suggestedSection} information?
        </p>
        <div class="flex flex-wrap gap-2">
          {suggestedLinks.map((link) => (
            <a href={link.url} class="bg-white text-brand-blue px-4 py-2 rounded-lg border border-blue-200 hover:bg-brand-blue hover:text-white transition-colors text-sm font-medium">
              {link.label}
            </a>
          ))}
        </div>
      </div>
    )}

    <!-- School Category Cards -->
    <div class="mb-12">
      <h3 class="text-xl font-bold text-gray-800 text-center mb-6">Browse Schools by Type</h3>
      <div class="grid grid-cols-2 md:grid-cols-3 gap-4 max-w-4xl mx-auto">
        {schoolCategories.map((category) => (
          <a href={category.href} class="group bg-white rounded-xl overflow-hidden shadow-sm border border-gray-100 hover:shadow-md hover:border-brand-blue/30 transition-all">
            <div class="aspect-[4/3] overflow-hidden">
              <img src={category.image.src} alt={category.title} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" />
            </div>
            <div class="p-3">
              <h4 class="font-semibold text-gray-800 group-hover:text-brand-blue transition-colors text-sm">{category.title}</h4>
              <p class="text-xs text-gray-500 mt-1 line-clamp-2">{category.description}</p>
            </div>
          </a>
        ))}
      </div>
    </div>

    <!-- Two Column Layout: State Browser + Articles -->
    <div class="grid md:grid-cols-2 gap-8 mb-12">
      <!-- State Browser -->
      <div class="bg-gradient-to-br from-slate-50 to-blue-50 border border-blue-100 rounded-xl p-6">
        <h3 class="text-lg font-bold text-brand-blue mb-4">
          <svg class="w-5 h-5 inline-block mr-1 -mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          Find Schools by State
        </h3>

        <!-- State Dropdown -->
        <div class="mb-4">
          <label for="state-select-404" class="block text-gray-600 font-medium text-xs mb-1.5 uppercase tracking-wide">Select Your State</label>
          <div class="relative">
            <select id="state-select-404" class="w-full appearance-none pl-4 pr-10 py-3 rounded-lg border border-gray-200 bg-white text-gray-700 cursor-pointer hover:border-brand-blue focus:outline-none focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all" onchange="if(this.value) window.location.href=this.value">
              <option value="">Choose a state...</option>
              {states.map((state) => (
                <option value={`/schools/${state.slug}`}>{state.name}</option>
              ))}
            </select>
            <svg class="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
          </div>
        </div>

        <!-- Popular States -->
        <p class="text-xs text-gray-500 uppercase tracking-wide mb-2">Popular States</p>
        <div class="flex flex-wrap gap-2">
          {popularStates.map((slug) => {
            const state = states.find(s => s.slug === slug);
            return state && (
              <a href={`/schools/${slug}`} class="bg-white text-gray-700 px-3 py-1.5 rounded-lg border border-gray-200 hover:border-brand-blue hover:text-brand-blue transition-colors text-sm">
                {state.name}
              </a>
            );
          })}
        </div>
      </div>

      <!-- Featured Articles -->
      <div class="bg-white border border-gray-100 rounded-xl p-6">
        <h3 class="text-lg font-bold text-brand-blue mb-4">
          <svg class="w-5 h-5 inline-block mr-1 -mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
          </svg>
          Education Guides
        </h3>
        <div class="space-y-4">
          {featuredArticles.map((article) => (
            <a href={article.url} class="flex gap-3 group">
              <img src={article.image.src} alt={article.title} class="w-16 h-16 object-cover rounded-lg flex-shrink-0" />
              <div>
                <h4 class="font-semibold text-gray-800 group-hover:text-brand-blue transition-colors text-sm leading-tight">{article.title}</h4>
                <p class="text-xs text-gray-500 mt-1 line-clamp-2">{article.description}</p>
              </div>
            </a>
          ))}
        </div>
        <div class="mt-4 pt-3 border-t border-gray-100">
          <a href="/education-articles" class="text-brand-blue hover:underline text-sm font-medium">Browse All Articles &rarr;</a>
        </div>
      </div>
    </div>

    <!-- Quick Links Footer -->
    <div class="text-center bg-gray-50 rounded-xl p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Links</h3>
      <div class="flex flex-wrap justify-center gap-x-6 gap-y-2 text-sm">
        <a href="/" class="text-brand-blue hover:underline">Homepage</a>
        <a href="/schools" class="text-brand-blue hover:underline">All K-12 Schools</a>
        <a href="/colleges-universities" class="text-brand-blue hover:underline">Colleges & Universities</a>
        <a href="/vocational-schools" class="text-brand-blue hover:underline">Vocational Schools</a>
        <a href="/financial-aid" class="text-brand-blue hover:underline">Financial Aid</a>
        <a href="/classes" class="text-brand-blue hover:underline">Free Online Classes</a>
        <a href="/education-articles" class="text-brand-blue hover:underline">Education Articles</a>
        <a href="/search" class="text-brand-blue hover:underline">Search</a>
      </div>
    </div>
  </div>
</Layout>
