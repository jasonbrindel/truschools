---
import Layout from '@/layouts/Layout.astro';
import featuredImage from '@/images/teaching-middle-school-1.jpg';
import kindergartenImage from '@/images/kindergarten-2.jpg';
import elementaryImage from '@/images/elementary-school-2.jpg';
import highSchoolImage from '@/images/high-school-1.jpg';
import collegeImage from '@/images/college-1.jpg';
import preschoolImage from '@/images/preschool-1.jpg';
import middleSchoolImage from '@/images/middle-school-1.jpg';
import sampleAdLeaderboard from '@/images/sample-ad-728x90.png';
import sampleAdSidebar from '@/images/sample-ad-336x280.png';

const db = Astro.locals.runtime?.env?.DB;

// Get stats for homepage
let stats = {
  totalSchools: 0,
  totalColleges: 0,
};

if (db) {
  try {
    const schoolCount = await db.prepare('SELECT COUNT(*) as count FROM schools WHERE active = 1').first();
    const collegeCount = await db.prepare('SELECT COUNT(*) as count FROM colleges WHERE active = 1').first();
    stats.totalSchools = schoolCount?.count || 0;
    stats.totalColleges = collegeCount?.count || 0;
  } catch (e) {
    // Database not yet set up
  }
}

// All US states for dropdowns
const states = [
  { name: 'Alabama', slug: 'alabama' },
  { name: 'Alaska', slug: 'alaska' },
  { name: 'Arizona', slug: 'arizona' },
  { name: 'Arkansas', slug: 'arkansas' },
  { name: 'California', slug: 'california' },
  { name: 'Colorado', slug: 'colorado' },
  { name: 'Connecticut', slug: 'connecticut' },
  { name: 'Delaware', slug: 'delaware' },
  { name: 'District of Columbia', slug: 'district-of-columbia' },
  { name: 'Florida', slug: 'florida' },
  { name: 'Georgia', slug: 'georgia' },
  { name: 'Hawaii', slug: 'hawaii' },
  { name: 'Idaho', slug: 'idaho' },
  { name: 'Illinois', slug: 'illinois' },
  { name: 'Indiana', slug: 'indiana' },
  { name: 'Iowa', slug: 'iowa' },
  { name: 'Kansas', slug: 'kansas' },
  { name: 'Kentucky', slug: 'kentucky' },
  { name: 'Louisiana', slug: 'louisiana' },
  { name: 'Maine', slug: 'maine' },
  { name: 'Maryland', slug: 'maryland' },
  { name: 'Massachusetts', slug: 'massachusetts' },
  { name: 'Michigan', slug: 'michigan' },
  { name: 'Minnesota', slug: 'minnesota' },
  { name: 'Mississippi', slug: 'mississippi' },
  { name: 'Missouri', slug: 'missouri' },
  { name: 'Montana', slug: 'montana' },
  { name: 'Nebraska', slug: 'nebraska' },
  { name: 'Nevada', slug: 'nevada' },
  { name: 'New Hampshire', slug: 'new-hampshire' },
  { name: 'New Jersey', slug: 'new-jersey' },
  { name: 'New Mexico', slug: 'new-mexico' },
  { name: 'New York', slug: 'new-york' },
  { name: 'North Carolina', slug: 'north-carolina' },
  { name: 'North Dakota', slug: 'north-dakota' },
  { name: 'Ohio', slug: 'ohio' },
  { name: 'Oklahoma', slug: 'oklahoma' },
  { name: 'Oregon', slug: 'oregon' },
  { name: 'Pennsylvania', slug: 'pennsylvania' },
  { name: 'Puerto Rico', slug: 'puerto-rico' },
  { name: 'Rhode Island', slug: 'rhode-island' },
  { name: 'South Carolina', slug: 'south-carolina' },
  { name: 'South Dakota', slug: 'south-dakota' },
  { name: 'Tennessee', slug: 'tennessee' },
  { name: 'Texas', slug: 'texas' },
  { name: 'Utah', slug: 'utah' },
  { name: 'Vermont', slug: 'vermont' },
  { name: 'Virginia', slug: 'virginia' },
  { name: 'Washington', slug: 'washington' },
  { name: 'West Virginia', slug: 'west-virginia' },
  { name: 'Wisconsin', slug: 'wisconsin' },
  { name: 'Wyoming', slug: 'wyoming' },
];

// School types - matching original site layout
const schoolTypes = [
  {
    title: 'Preschools',
    href: '/preschools',
    description: 'Comprehensive listings of all public and private preschools plus articles and other helpful information.',
    image: preschoolImage.src,
  },
  {
    title: 'Elementary Schools',
    href: '/elementary-schools',
    description: 'Comprehensive listings of all public & private elementary schools plus articles and other helpful information.',
    image: elementaryImage.src,
  },
  {
    title: 'High Schools',
    href: '/high-schools',
    description: 'Comprehensive listings of all public and private high schools plus articles and other helpful information.',
    image: highSchoolImage.src,
  },
  {
    title: 'Kindergartens',
    href: '/kindergartens',
    description: 'Listings of all public and private kindergartens plus articles and other helpful information.',
    image: kindergartenImage.src,
  },
  {
    title: 'Middle Schools',
    href: '/middle-schools',
    description: 'Comprehensive listings of all public and private middle schools plus articles and other helpful information.',
    image: middleSchoolImage.src,
  },
  {
    title: 'Colleges & Universities',
    href: '/colleges',
    description: 'Listings of all colleges and universities plus articles and other helpful information.',
    image: collegeImage.src,
  },
];
---

<Layout title="Information on Colleges, Universities & K-12 Schools in U.S.">
  <div class="container">
    <!-- Page Header -->
    <h1 class="mt-5 text-brand-green-text">
      TruSchools <span class="fs-14 text-body font-normal leading-snug">| Guides & Directories to Schools, Colleges & Universities Plus Helpful Information Concerning All Things Education.</span>
    </h1>
  </div>

  <div class="container py-5">
    <!-- Two Column Layout like original -->
    <div class="flex flex-col lg:flex-row gap-5">
      <!-- Left Column - Main Content (728px for ad compatibility) -->
      <div class="lg:w-[728px] lg:flex-shrink-0">
        <!-- Main Content Ad -->
        <div class="mb-5">
          <a href="#" class="hidden md:block">
            <img src={sampleAdLeaderboard.src} alt="Advertisement" class="w-[728px] h-[90px]" />
          </a>
          <a href="#" class="block md:hidden mx-auto w-[320px]">
            <img src={sampleAdLeaderboard.src} alt="Advertisement" class="w-[320px] h-[50px] object-cover object-left" />
          </a>
        </div>

        <!-- Featured Article Box -->
        <div class="box-rounded">
          <a href="/resources/find-schools/how-to-find-right-school-for-your-child">
            <img src={featuredImage.src} alt="Finding & Evaluating Schools for Your Child" class="w-full h-auto mb-4 rounded-box" />
          </a>
          <h2 class="space-0">
            <a href="/resources/find-schools/how-to-find-right-school-for-your-child">Finding & Evaluating Schools for Your Child</a>
          </h2>
          <p class="space-0">
            Choosing the right school for your child is one of the most important decisions you will make when it comes to your child's future. Follow these tips to help you choose wisely...
            <a href="/resources/find-schools/how-to-find-right-school-for-your-child">&gt;&gt; Read more</a>
          </p>
        </div>

        <!-- School Types Grid -->
        <div class="box-rounded">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-0">
            {schoolTypes.map((type, index) => (
              <div class={`p-3 ${index < schoolTypes.length - 2 ? 'line-dotted' : ''}`}>
                <div class="flex gap-3">
                  <a href={type.href}>
                    <img src={type.image} alt={type.title} class="w-[110px] h-[110px] min-w-[110px] min-h-[110px] object-cover flex-shrink-0 rounded" />
                  </a>
                  <div class="fs-13">
                    <h3 class="space-5">
                      <a href={type.href}>{type.title}</a>
                    </h3>
                    <p class="mb-2">{type.description}</p>
                    <p class="fs-12 space-0 text-brand-green-text">
                      View schools by state:
                      <select
                        class="state-select ml-1"
                        onchange={`if(this.value) window.location.href=this.value`}
                      >
                        <option value="">-- Select Your State --</option>
                        {states.map((state) => (
                          <option value={`${type.href}/${state.slug}`}>
                            {state.name} {type.title}
                          </option>
                        ))}
                      </select>
                    </p>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

        <!-- Education Q&A Section -->
        <div class="box-rounded bg-lt-green">
          <div class="flex items-center gap-2 mb-2">
            <span class="text-brand-green-dark text-xl">‚ùì</span>
            <h3 class="text-brand-green-dark mb-0 font-bold">Education Q&A</h3>
          </div>
          <div class="line-dotted mb-3"></div>
          <p class="text-brand-green-text italic fs-13 mb-3">
            Q: What number one tip would you give to other parents to help them find the right school?
          </p>
          <form action="/qa/submit" method="POST">
            <label class="block text-brand-green-text font-bold fs-13 mb-1">Your Answer:</label>
            <textarea
              name="answer"
              rows="3"
              class="input w-full mb-2 resize-none"
              placeholder="Share your advice..."
            ></textarea>
            <div class="flex justify-end">
              <button type="submit" class="btn-green text-sm px-4 py-1.5">
                Submit
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Right Column - Sidebar (fills remaining space) -->
      <div class="lg:flex-shrink-0 lg:w-[336px]">
        <!-- Sidebar Ad 1 -->
        <div class="mb-5 flex justify-center">
          <a href="#">
            <img src={sampleAdSidebar.src} alt="Advertisement" class="w-[336px] h-[280px]" />
          </a>
        </div>

        <!-- Search Box -->
        <div class="box-rounded bg-lt-blue">
          <h3 class="text-brand-blue mb-3">Search Schools</h3>
          <form action="/search" method="GET">
            <input
              type="text"
              name="q"
              placeholder="School name, city, or ZIP..."
              class="input w-full mb-2"
            />
            <button type="submit" class="btn-blue w-full">
              Search
            </button>
          </form>
        </div>

        <!-- Quick Stats -->
        <div class="box-rounded">
          <h3 class="text-brand-blue mb-3">Site Statistics</h3>
          <ul class="list-none m-0 p-0 fs-13">
            <li class="py-2 line-dotted">
              <strong class="text-brand-blue">{stats.totalSchools > 0 ? stats.totalSchools.toLocaleString() : '130,000+'}</strong> K-12 Schools
            </li>
            <li class="py-2 line-dotted">
              <strong class="text-brand-blue">{stats.totalColleges > 0 ? stats.totalColleges.toLocaleString() : '7,000+'}</strong> Colleges & Universities
            </li>
            <li class="py-2 line-dotted">
              <strong class="text-brand-blue">50+</strong> States & Territories
            </li>
            <li class="py-2">
              <strong class="text-brand-green">Free</strong> to use - always!
            </li>
          </ul>
        </div>

        <!-- Special School Types -->
        <div class="box-rounded">
          <h3 class="text-brand-blue mb-3">School Types</h3>
          <ul class="list-none m-0 p-0 fs-13">
            <li class="py-1">
              <a href="/charter-schools">Charter Schools</a>
            </li>
            <li class="py-1">
              <a href="/magnet-schools">Magnet Schools</a>
            </li>
            <li class="py-1">
              <a href="/private-schools">Private Schools</a>
            </li>
            <li class="py-1">
              <a href="/public-schools">Public Schools</a>
            </li>
          </ul>
        </div>

        <!-- Resources -->
        <div class="box-rounded bg-lt-green">
          <h3 class="text-brand-green-dark mb-3">Resources</h3>
          <ul class="list-none m-0 p-0 fs-13">
            <li class="py-1">
              <a href="/resources/financial-aid">Financial Aid Information</a>
            </li>
            <li class="py-1">
              <a href="/resources/school-choice">School Choice Guide</a>
            </li>
            <li class="py-1">
              <a href="/resources/special-education">Special Education</a>
            </li>
          </ul>
        </div>

        <!-- Sidebar Ad 2 -->
        <div class="mt-5 flex justify-center">
          <a href="#">
            <img src={sampleAdSidebar.src} alt="Advertisement" class="w-[336px] h-[280px]" />
          </a>
        </div>
      </div>
    </div>
  </div>
</Layout>
