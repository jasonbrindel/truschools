---
export const prerender = true;
import Layout from '@/layouts/Layout.astro';
---
export const prerender = true;

<Layout title="Login - TruSchools" description="Sign in to TruSchools.">
  <style>
    .login-checkbox {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .login-checkbox-label {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      cursor: pointer;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .login-checkbox-custom {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 1.375rem;
      height: 1.375rem;
      border: 2px solid #d1d5db;
      border-radius: 0.375rem;
      background-color: white;
      transition: all 0.15s ease;
      flex-shrink: 0;
    }

    @media (max-width: 640px) {
      .login-checkbox-custom {
        width: 1.5rem;
        height: 1.5rem;
      }
    }

    .login-checkbox-icon {
      width: 0.75rem;
      height: 0.75rem;
      color: white;
      opacity: 0;
      transform: scale(0.5);
      transition: all 0.15s ease;
    }

    .login-checkbox:checked + .login-checkbox-custom {
      background-color: #2563eb;
      border-color: #2563eb;
    }

    .login-checkbox:checked + .login-checkbox-custom .login-checkbox-icon {
      opacity: 1;
      transform: scale(1);
    }

    .login-checkbox:focus + .login-checkbox-custom {
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
    }

    .login-checkbox-custom:hover {
      border-color: #9ca3af;
    }

    .login-checkbox:checked + .login-checkbox-custom:hover {
      background-color: #1d4ed8;
      border-color: #1d4ed8;
    }
  </style>
  <div class="min-h-[70vh] flex items-center justify-center py-12 px-4">
    <div class="w-full max-w-md">
      <!-- Logo/Brand -->
      <div class="text-center mb-8">
        <a href="/" class="inline-block">
          <span class="text-3xl font-bold">
            <span class="text-brand-green">Tru</span><span class="text-brand-blue">Schools</span>
          </span>
        </a>
        <p class="mt-2 text-gray-500">Sign in to continue</p>
      </div>

      <!-- Login Card -->
      <div class="bg-white rounded-lg shadow-lg border border-gray-200 p-8">
        <form id="login-form" class="space-y-5">
          <div>
            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              autocomplete="email"
              class="input w-full"
              placeholder="you@example.com"
            />
          </div>

          <div>
            <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input
              type="password"
              id="password"
              name="password"
              required
              autocomplete="current-password"
              class="input w-full"
              placeholder="Enter your password"
            />
          </div>

          <div class="flex items-center">
            <label class="login-checkbox-label group">
              <input type="checkbox" name="remember" class="login-checkbox" />
              <span class="login-checkbox-custom">
                <svg class="login-checkbox-icon" viewBox="0 0 12 10" fill="none">
                  <path d="M1 5L4.5 8.5L11 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
              <span class="text-sm text-gray-600 group-hover:text-gray-800 transition-colors">Remember me</span>
            </label>
          </div>

          <div id="error-message" class="hidden p-3 bg-red-50 border border-red-200 rounded text-red-700 text-sm"></div>

          <button type="submit" id="submit-btn" class="btn-blue w-full text-center py-3">
            Sign In
          </button>
        </form>

        <script is:inline>
          document.addEventListener('DOMContentLoaded', function() {
            var form = document.getElementById('login-form');
            var errorDiv = document.getElementById('error-message');
            var submitBtn = document.getElementById('submit-btn');

            if (form) {
              form.addEventListener('submit', async function(e) {
                e.preventDefault();
                errorDiv.classList.add('hidden');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Signing in...';

                var formData = new FormData(form);
                var email = formData.get('email');
                var password = formData.get('password');
                var remember = formData.get('remember') === 'on';

                try {
                  var response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email, password: password, remember: remember }),
                    credentials: 'same-origin'
                  });

                  var data = await response.json();

                  if (data.success) {
                    document.location = '/admin/content/prompt-builder';
                    return;
                  } else {
                    errorDiv.textContent = data.error || 'Invalid credentials. Please try again.';
                    errorDiv.classList.remove('hidden');
                  }
                } catch (error) {
                  console.error('Login error:', error);
                  errorDiv.textContent = 'An error occurred. Please try again.';
                  errorDiv.classList.remove('hidden');
                } finally {
                  submitBtn.disabled = false;
                  submitBtn.textContent = 'Sign In';
                }
              });
            }
          });
        </script>
      </div>

      <!-- Footer -->
      <div class="mt-8 text-center">
        <a href="/" class="text-sm text-gray-500 hover:text-brand-blue">
          &larr; Back to TruSchools
        </a>
      </div>
    </div>
  </div>
</Layout>
