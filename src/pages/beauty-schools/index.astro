---
import Layout from '@/layouts/Layout.astro';
import QAPoll from '@/components/QAPoll.astro';

const db = Astro.locals.runtime.env.DB;

// Get counts by state for beauty schools
const stateCountsResult = await db.prepare(`
  SELECT state_abbr, COUNT(*) as count
  FROM colleges
  WHERE vocational_type = 'beauty' AND active = 1
  GROUP BY state_abbr
  ORDER BY count DESC
`).all();

const stateCounts = stateCountsResult.results;

// Get total beauty schools
const totalResult = await db.prepare(`
  SELECT COUNT(*) as total FROM colleges
  WHERE vocational_type = 'beauty' AND active = 1
`).first() as { total: number };
const totalSchools = totalResult?.total || 0;

// Get featured schools (largest by enrollment)
const featuredResult = await db.prepare(`
  SELECT id, institution_name, page_name, city, state_abbr, total_enrollment, tuition_in_state
  FROM colleges
  WHERE vocational_type = 'beauty' AND active = 1
    AND total_enrollment IS NOT NULL
  ORDER BY total_enrollment DESC
  LIMIT 10
`).all();

const featuredSchools = featuredResult.results;

// State name mapping
const stateNames: Record<string, string> = {
  'AL': 'Alabama', 'AK': 'Alaska', 'AZ': 'Arizona', 'AR': 'Arkansas',
  'CA': 'California', 'CO': 'Colorado', 'CT': 'Connecticut', 'DE': 'Delaware',
  'DC': 'District of Columbia', 'FL': 'Florida', 'GA': 'Georgia', 'HI': 'Hawaii',
  'ID': 'Idaho', 'IL': 'Illinois', 'IN': 'Indiana', 'IA': 'Iowa',
  'KS': 'Kansas', 'KY': 'Kentucky', 'LA': 'Louisiana', 'ME': 'Maine',
  'MD': 'Maryland', 'MA': 'Massachusetts', 'MI': 'Michigan', 'MN': 'Minnesota',
  'MS': 'Mississippi', 'MO': 'Missouri', 'MT': 'Montana', 'NE': 'Nebraska',
  'NV': 'Nevada', 'NH': 'New Hampshire', 'NJ': 'New Jersey', 'NM': 'New Mexico',
  'NY': 'New York', 'NC': 'North Carolina', 'ND': 'North Dakota', 'OH': 'Ohio',
  'OK': 'Oklahoma', 'OR': 'Oregon', 'PA': 'Pennsylvania', 'PR': 'Puerto Rico',
  'RI': 'Rhode Island', 'SC': 'South Carolina', 'SD': 'South Dakota',
  'TN': 'Tennessee', 'TX': 'Texas', 'UT': 'Utah', 'VT': 'Vermont',
  'VA': 'Virginia', 'WA': 'Washington', 'WV': 'West Virginia',
  'WI': 'Wisconsin', 'WY': 'Wyoming'
};

function getStateSlug(abbr: string): string {
  const name = stateNames[abbr] || abbr;
  return name.toLowerCase().replace(/\s+/g, '-');
}
---

<Layout title="Beauty Schools & Cosmetology Programs" description={`Find ${totalSchools.toLocaleString()} accredited beauty schools and cosmetology programs across the United States.`}>
  <div class="container py-5">
    <!-- Breadcrumb -->
    <nav class="text-sm mb-4">
      <ol class="flex flex-wrap items-center gap-2 text-gray-600">
        <li><a href="/" class="hover:text-brand-blue">Home</a></li>
        <li class="text-gray-400">/</li>
        <li><a href="/vocational-schools" class="hover:text-brand-blue">Vocational Schools</a></li>
        <li class="text-gray-400">/</li>
        <li class="text-gray-900 font-medium">Beauty Schools</li>
      </ol>
    </nav>

    <h1 class="text-brand-green-text mb-2">Beauty Schools & Cosmetology Programs</h1>
    <p class="fs-14 text-gray-500 mb-5">{totalSchools.toLocaleString()} accredited beauty schools nationwide</p>

    <div class="flex flex-col lg:flex-row gap-5">
      <!-- Main Content -->
      <div class="lg:w-2/3">
        <!-- Introduction -->
        <div class="box-rounded mb-5">
          <h2 class="text-brand-blue mb-3">Start Your Beauty Career</h2>
          <p class="text-gray-700 mb-3">
            Beauty school programs prepare students for exciting careers in cosmetology, esthetics, nail technology,
            barbering, and salon management. Most programs can be completed in less than a year, giving you a fast
            path to a creative and rewarding career.
          </p>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mt-4">
            <div class="text-center p-3 bg-lt-blue rounded">
              <div class="text-2xl font-bold text-brand-blue">6-12</div>
              <div class="fs-12 text-gray-600">Months Average</div>
            </div>
            <div class="text-center p-3 bg-lt-blue rounded">
              <div class="text-2xl font-bold text-brand-blue">$5K-$20K</div>
              <div class="fs-12 text-gray-600">Tuition Range</div>
            </div>
            <div class="text-center p-3 bg-lt-blue rounded">
              <div class="text-2xl font-bold text-brand-blue">600-1500</div>
              <div class="fs-12 text-gray-600">Training Hours</div>
            </div>
            <div class="text-center p-3 bg-lt-blue rounded">
              <div class="text-2xl font-bold text-brand-blue">$35K+</div>
              <div class="fs-12 text-gray-600">Avg Salary</div>
            </div>
          </div>
        </div>

        <!-- Featured Schools -->
        {featuredSchools.length > 0 && (
          <div class="mb-6">
            <h2 class="text-brand-blue mb-4">Featured Beauty Schools</h2>
            <div class="space-y-3">
              {featuredSchools.map((school: any) => (
                <a href={`/beauty-schools/${getStateSlug(school.state_abbr)}/${school.page_name}`}
                   class="block box-rounded hover:border-brand-blue transition-colors no-underline">
                  <div class="flex justify-between items-start">
                    <div>
                      <h3 class="text-brand-blue mb-1">{school.institution_name}</h3>
                      <p class="text-gray-600 fs-13 mb-0">{school.city}, {stateNames[school.state_abbr] || school.state_abbr}</p>
                    </div>
                    <div class="text-right">
                      {school.total_enrollment && (
                        <div class="text-brand-green-text font-bold">{school.total_enrollment.toLocaleString()} students</div>
                      )}
                      {school.tuition_in_state && (
                        <div class="text-gray-500 fs-13">${school.tuition_in_state.toLocaleString()}</div>
                      )}
                    </div>
                  </div>
                </a>
              ))}
            </div>
          </div>
        )}

        <!-- Browse by State -->
        <h2 class="text-brand-blue mb-4">Browse by State</h2>
        <div class="box-rounded">
          <div class="grid grid-cols-2 md:grid-cols-4 gap-2 fs-13">
            {stateCounts.map((state: any) => (
              <a href={`/beauty-schools/${getStateSlug(state.state_abbr)}`} class="text-brand-blue hover:underline py-1">
                {stateNames[state.state_abbr] || state.state_abbr} ({state.count})
              </a>
            ))}
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="lg:w-1/3">
        <!-- Programs Offered -->
        <div class="box-rounded bg-lt-blue mb-4">
          <h3 class="text-brand-blue mb-3">Program Types</h3>
          <ul class="list-none m-0 p-0 space-y-2 fs-14">
            <li class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-brand-green"></span>
              Cosmetology
            </li>
            <li class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-brand-green"></span>
              Esthetics / Skincare
            </li>
            <li class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-brand-green"></span>
              Nail Technology
            </li>
            <li class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-brand-green"></span>
              Barbering
            </li>
            <li class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-brand-green"></span>
              Makeup Artistry
            </li>
            <li class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-brand-green"></span>
              Salon Management
            </li>
          </ul>
        </div>

        <!-- Ad Placeholder -->
        <div class="box-rounded mb-4">
          <div class="bg-gray-100 h-[280px] flex items-center justify-center text-gray-400 fs-13">
            Advertisement
          </div>
        </div>

        <!-- Career Paths -->
        <div class="box-rounded mb-4">
          <h3 class="text-brand-blue mb-3">Career Opportunities</h3>
          <ul class="list-disc pl-5 space-y-1 fs-13 text-gray-700">
            <li>Hair Stylist</li>
            <li>Esthetician</li>
            <li>Nail Technician</li>
            <li>Barber</li>
            <li>Makeup Artist</li>
            <li>Salon Owner</li>
            <li>Spa Manager</li>
            <li>Beauty Educator</li>
          </ul>
        </div>

        <!-- Quick Poll -->
        <div class="box-rounded mb-4">
          <QAPoll
            questionId="beauty-career-interest"
            pageSlug="beauty-schools"
            question="Which beauty career interests you most?"
            answers={["Hair Stylist", "Esthetician", "Nail Technician", "Makeup Artist"]}
          />
        </div>

        <!-- Related Categories -->
        <div class="box-rounded">
          <h3 class="text-brand-blue mb-3">Related Programs</h3>
          <ul class="list-none m-0 p-0 space-y-2 fs-14">
            <li><a href="/healthcare-schools" class="text-brand-blue hover:underline">Healthcare Schools</a></li>
            <li><a href="/trade-schools" class="text-brand-blue hover:underline">Trade Schools</a></li>
            <li><a href="/vocational-schools" class="text-brand-blue hover:underline">All Vocational Schools</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</Layout>
